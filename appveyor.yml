version: '1.0.{build}'
configuration:
  - Debug
  - Release
platform: Any CPU
hosts:
  api.nuget.org: 93.184.221.200
environment:
  # Don't report back to the mothership
  DOTNET_CLI_TELEMETRY_OPTOUT: 1
init:
  - ps: $Env:BUILD = "$($Env:APPVEYOR_BUILD_NUMBER.PadLeft(5, "0"))"
before_build:
  - appveyor-retry dotnet restore NoAdsHere.sln --configfile Nuget/Nuget.Config
build_script:
  - dotnet build "NoAdsHere\NoAdsHere.csproj" -c %CONFIGURATION% --no-dependencies
  - dotnet build "UnitTests\UnitTests.csproj" -c %CONFIGURATION% --no-dependencies
before_test:
  - ps: >-
$a = Get-Content 'NoAdsHere\config.json' -raw | ConvertFrom-Json
$a.token = %BOTTOKEN%
$a | ConvertTo-Json | set-content 'UnitTests\UnitTests\bin\Any CPU\%CONFIGURATION%\netcoreapp1.1\config.json'
test_script:
  - ps: dotnet test UnitTests/UnitTests.csproj -c "Release" --no-build